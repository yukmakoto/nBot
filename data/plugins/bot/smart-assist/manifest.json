{
  "id": "smart-assist",
  "name": "智能助手",
  "version": "2.2.31",
  "author": "nBot",
  "description": "智能对话助手：自动监控群聊消息并识别求助场景（无需@；@会提高优先级），用 QQ 群友风格的一行短句给出下一步建议；支持跟进上下文多模态（图片/视频/语音）。",
  "type": "bot",
  "entry": "index.js",
  "codeType": "module",
  "permissions": [],
  "signature": null,
  "builtin": true,
  "commands": [],
  "configSchema": [
    {
      "key": "decision_merge_seconds",
      "type": "number",
      "label": "消息合并窗口(秒)",
      "description": "仅用于「决策模型」：同一用户在短时间内的多条消息会合并后再做一次决策，以降低模型消耗；@ 机器人时会立即触发（不等待）。",
      "default": 5,
      "options": null,
      "itemType": null,
      "min": 1,
      "max": 30
    },
    {
      "key": "reply_merge_seconds",
      "type": "number",
      "label": "回复合并窗口(秒)",
      "description": "仅用于「回复模型」：会话中用户连续发送多条消息时，等待用户停顿后再回复一次，避免连发刷屏。",
      "default": 1.2,
      "options": null,
      "itemType": null,
      "min": 0,
      "max": 5
    },
    {
      "key": "reply_merge_max_seconds",
      "type": "number",
      "label": "回复最大等待(秒)",
      "description": "当用户持续刷屏时，最多等待多久就必须回复一次（避免永远等不到停顿）。",
      "default": 5,
      "options": null,
      "itemType": null,
      "min": 1,
      "max": 15
    },
    {
      "key": "decision_model",
      "type": "string",
      "label": "决策模型",
      "description": "用于判断用户是否需要帮助的模型映射名称（需在 LLM 模块中配置）",
      "default": "default",
      "options": null,
      "itemType": null,
      "min": null,
      "max": null
    },
    {
      "key": "reply_model",
      "type": "string",
      "label": "回复模型",
      "description": "用于多轮对话的模型映射名称（需在 LLM 模块中配置）",
      "default": "default",
      "options": null,
      "itemType": null,
      "min": null,
      "max": null
    },
    {
      "key": "websearch_model",
      "type": "string",
      "label": "联网搜索模型",
      "description": "用于联网搜索（函数调用 + Tavily）的模型映射名称（需在 LLM 模块中配置，并配置 llm.tavily_api_key）。",
      "default": "default",
      "options": null,
      "itemType": null,
      "min": null,
      "max": null
    },
    {
      "key": "enable_websearch",
      "type": "boolean",
      "label": "启用联网搜索",
      "description": "是否允许助手在需要外部知识时使用联网搜索（由决策模型通过 use_search 决定）。",
      "default": true,
      "options": null,
      "itemType": null,
      "min": null,
      "max": null
    },
    {
      "key": "max_turns",
      "type": "number",
      "label": "最大对话轮数",
      "description": "单次会话的最大对话轮数",
      "default": 10,
      "options": null,
      "itemType": null,
      "min": 3,
      "max": 30
    },
    {
      "key": "session_timeout_minutes",
      "type": "number",
      "label": "会话超时(分钟)",
      "description": "会话无活动后自动结束的时间",
      "default": 10,
      "options": null,
      "itemType": null,
      "min": 1,
      "max": 60
    },
    {
      "key": "cooldown_seconds",
      "type": "number",
      "label": "冷却时间(秒)",
      "description": "同一用户两次触发智能助手的最小间隔",
      "default": 60,
      "options": null,
      "itemType": null,
      "min": 0,
      "max": 300
    },
    {
      "key": "auto_trigger",
      "type": "boolean",
      "label": "自动触发",
      "description": "是否在群聊中自动监控并识别求助类消息（无需@；@会提高优先级）。关闭后不会自动触发。",
      "default": true,
      "options": null,
      "itemType": null,
      "min": null,
      "max": null
    },
    {
      "key": "fetch_group_context",
      "type": "boolean",
      "label": "获取群上下文",
      "description": "在判断用户是否需要帮助时，是否获取群公告和用户历史消息作为上下文",
      "default": true,
      "options": null,
      "itemType": null,
      "min": null,
      "max": null
    },
    {
      "key": "context_message_count",
      "type": "number",
      "label": "上下文消息数量",
      "description": "获取群历史消息的数量（用于决策上下文）",
      "default": 20,
      "options": null,
      "itemType": null,
      "min": 5,
      "max": 100
    },
    {
      "key": "always_reply_in_session",
      "type": "boolean",
      "label": "会话内每条都回复",
      "description": "进入会话后是否默认每条消息都回复（更像正常对话；关闭则由决策模型决定）。",
      "default": false,
      "options": null,
      "itemType": null,
      "min": null,
      "max": null
    },
    {
      "key": "mention_user_on_first_reply",
      "type": "boolean",
      "label": "首条回复@用户",
      "description": "开始会话时首条回复是否@用户（更容易被看到）。",
      "default": true,
      "options": null,
      "itemType": null,
      "min": null,
      "max": null
    },
    {
      "key": "mention_cooldown_seconds",
      "type": "number",
      "label": "@冷却时间(秒)",
      "description": "两次@同一用户的最小间隔（避免过吵；慢回复时会按需@）。",
      "default": 30,
      "options": null,
      "itemType": null,
      "min": 0,
      "max": 600
    },
    {
      "key": "mention_on_slow_reply_seconds",
      "type": "number",
      "label": "慢回复时@阈值(秒)",
      "description": "当回复距离用户发言/模型耗时超过该阈值时，会更倾向于@用户以避免回复失去指向性。",
      "default": 6,
      "options": null,
      "itemType": null,
      "min": 0,
      "max": 60
    },
    {
      "key": "mention_user_on_every_reply",
      "type": "boolean",
      "label": "每条回复@用户",
      "description": "会话内每条回复是否@用户（更容易被看到，但更吵）。",
      "default": false,
      "options": null,
      "itemType": null,
      "min": null,
      "max": null
    },
    {
      "key": "stale_reply_drop_seconds",
      "type": "number",
      "label": "丢弃过期回复(秒)",
      "description": "若用户在模型回复途中继续发消息，且模型耗时超过该阈值，则丢弃这条可能过期的回复，等待下一轮合并后再回。",
      "default": 2.5,
      "options": null,
      "itemType": null,
      "min": 0,
      "max": 60
    }
  ],
  "config": {
    "decision_merge_seconds": 5,
    "reply_merge_seconds": 1.2,
    "reply_merge_max_seconds": 5,
    "decision_model": "default",
    "reply_model": "default",
    "websearch_model": "default",
    "enable_websearch": true,
    "max_turns": 10,
    "session_timeout_minutes": 10,
    "cooldown_seconds": 60,
    "auto_trigger": true,
    "fetch_group_context": true,
    "context_message_count": 20,
    "always_reply_in_session": false,
    "mention_user_on_first_reply": true,
    "mention_cooldown_seconds": 30,
    "mention_on_slow_reply_seconds": 6,
    "mention_user_on_every_reply": false,
    "stale_reply_drop_seconds": 2.5
  }
}
